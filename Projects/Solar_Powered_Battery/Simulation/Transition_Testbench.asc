Version 4
SHEET 1 2632 1620
WIRE 1888 -160 1808 -160
WIRE 2016 -160 1984 -160
WIRE 2080 -160 2016 -160
WIRE 2128 -160 2080 -160
WIRE 2304 -160 2224 -160
WIRE 2016 -144 2016 -160
WIRE 2080 -144 2080 -160
WIRE 1968 -48 1968 -112
WIRE 2016 -48 2016 -64
WIRE 2016 -48 1968 -48
WIRE 2080 -48 2080 -80
WIRE 2080 -48 2016 -48
WIRE 2144 -48 2144 -112
WIRE 2144 -48 2080 -48
WIRE 2080 -16 2080 -48
WIRE 2144 -16 2080 -16
WIRE 2224 -16 2208 -16
WIRE 2304 -16 2304 -160
WIRE 2080 0 2080 -16
WIRE 736 16 656 16
WIRE 848 16 800 16
WIRE 2304 48 2304 -16
WIRE 2352 48 2304 48
WIRE 2432 48 2352 48
WIRE 2528 48 2432 48
WIRE 2000 80 1920 80
WIRE 2032 80 2000 80
WIRE 224 96 144 96
WIRE 352 96 288 96
WIRE 656 96 656 16
WIRE 736 96 656 96
WIRE 848 96 848 16
WIRE 848 96 800 96
WIRE 880 96 848 96
WIRE 992 96 960 96
WIRE 1024 96 992 96
WIRE 1056 96 1024 96
WIRE 2000 96 2000 80
WIRE 352 128 352 96
WIRE 384 128 352 128
WIRE 528 128 464 128
WIRE 592 128 528 128
WIRE 1024 128 1024 96
WIRE 144 160 144 96
WIRE 224 160 144 160
WIRE 352 160 352 128
WIRE 352 160 288 160
WIRE 2432 160 2432 48
WIRE 656 192 656 96
WIRE 144 208 144 160
WIRE 2000 208 2000 176
WIRE 2080 208 2080 96
WIRE 1024 224 1024 192
WIRE 2528 224 2528 48
WIRE 1792 272 1712 272
WIRE 1888 272 1792 272
WIRE 2016 272 1984 272
WIRE 2080 272 2016 272
WIRE 2128 272 2080 272
WIRE 2304 272 2304 48
WIRE 2304 272 2224 272
WIRE 2016 288 2016 272
WIRE 2080 288 2080 272
WIRE 2432 288 2432 224
WIRE 656 304 656 272
WIRE 144 336 144 288
WIRE 1296 336 1216 336
WIRE 1408 336 1360 336
WIRE 720 384 656 384
WIRE 848 384 784 384
WIRE 1968 384 1968 320
WIRE 2016 384 2016 368
WIRE 2016 384 1968 384
WIRE 2080 384 2080 352
WIRE 2080 384 2016 384
WIRE 2144 384 2144 320
WIRE 2144 384 2080 384
WIRE 2528 384 2528 304
WIRE 1216 416 1216 336
WIRE 1296 416 1216 416
WIRE 1408 416 1408 336
WIRE 1408 416 1360 416
WIRE 1440 416 1408 416
WIRE 1552 416 1520 416
WIRE 1584 416 1552 416
WIRE 1616 416 1584 416
WIRE 656 432 656 384
WIRE 720 432 656 432
WIRE 848 432 848 384
WIRE 848 432 784 432
WIRE 864 432 848 432
WIRE 992 432 944 432
WIRE 1024 432 992 432
WIRE 1136 432 1136 384
WIRE 2080 432 2080 384
WIRE 2128 432 2080 432
WIRE 2224 432 2192 432
WIRE 2304 432 2304 272
WIRE 1584 448 1584 416
WIRE 2080 448 2080 432
WIRE 992 480 992 432
WIRE 1136 480 1136 432
WIRE 656 496 656 432
WIRE 1216 512 1216 416
WIRE 2000 528 1952 528
WIRE 2032 528 2000 528
WIRE 1584 544 1584 512
WIRE 2000 544 2000 528
WIRE 656 608 656 576
WIRE 992 608 992 544
WIRE 1136 640 1136 560
WIRE 1216 640 1216 592
WIRE 928 656 912 656
WIRE 944 656 928 656
WIRE 2000 656 2000 624
WIRE 2080 656 2080 544
WIRE 944 704 944 656
WIRE 944 816 944 784
WIRE 944 816 816 816
WIRE 1008 816 944 816
WIRE 1072 816 1008 816
WIRE 1328 816 1072 816
WIRE 816 832 816 816
WIRE 1072 864 1072 816
WIRE 1872 864 1872 816
WIRE 2176 864 2176 832
WIRE 1472 896 1440 896
WIRE 1872 896 1872 864
WIRE 2176 896 2176 864
WIRE 1472 928 1472 896
WIRE 1008 944 1008 816
WIRE 1008 944 976 944
WIRE 816 960 816 912
WIRE 912 960 816 960
WIRE 1184 960 1184 912
WIRE 1008 976 976 976
WIRE 1072 976 1072 928
WIRE 1184 992 1184 960
WIRE 816 1008 816 960
WIRE 1872 1008 1872 976
WIRE 2032 1008 1872 1008
WIRE 2176 1008 2176 976
WIRE 1872 1040 1872 1008
WIRE 2176 1040 2176 1008
WIRE 1440 1056 1440 896
WIRE 1328 1072 1328 816
WIRE 1360 1072 1328 1072
WIRE 1408 1072 1360 1072
WIRE 1584 1088 1472 1088
WIRE 1648 1088 1584 1088
WIRE 1760 1088 1728 1088
WIRE 1808 1088 1760 1088
WIRE 2112 1088 2032 1088
WIRE 1184 1104 1184 1072
WIRE 1360 1104 1184 1104
WIRE 1408 1104 1360 1104
WIRE 816 1136 816 1088
WIRE 1008 1136 1008 976
WIRE 1008 1136 816 1136
WIRE 1184 1136 1184 1104
WIRE 1760 1136 1760 1088
WIRE 1008 1200 1008 1136
WIRE 1440 1216 1440 1120
WIRE 1872 1216 1872 1136
WIRE 2176 1216 2176 1136
WIRE 1440 1232 1440 1216
WIRE 1184 1248 1184 1216
WIRE 1280 1392 1264 1392
WIRE 1328 1392 1280 1392
WIRE 1440 1392 1392 1392
WIRE 1440 1440 1440 1392
WIRE 1488 1440 1440 1440
WIRE 1280 1488 1264 1488
WIRE 1328 1488 1280 1488
WIRE 1440 1488 1440 1440
WIRE 1440 1488 1392 1488
WIRE 1488 1488 1488 1440
WIRE 1488 1600 1488 1552
FLAG 144 336 0
FLAG 528 128 SPV
FLAG 656 304 0
FLAG 992 96 BUCK_5V0
FLAG 656 608 0
FLAG 992 432 BAT
FLAG 992 608 0
FLAG 1024 224 0
FLAG 1216 640 0
FLAG 1552 416 BOOST_5V0
FLAG 1584 544 0
FLAG 1136 640 0
FLAG 1136 432 BOOST_EN
FLAG 1184 1248 0
FLAG 1184 960 SPV
FLAG 1360 1072 op_V+
FLAG 1360 1104 op_V-
FLAG 1584 1088 op_out
FLAG 1872 1216 0
FLAG 1872 864 VCC_REF
FLAG 1872 1008 off_sw
FLAG 1440 1216 VCC_REF
FLAG 1472 928 0
FLAG 2176 1216 0
FLAG 2176 864 VCC_REF
FLAG 2176 1008 on_sw
FLAG 1920 80 off_sw
FLAG 1808 -160 BUCK_5V0
FLAG 1952 528 on_sw
FLAG 2528 384 0
FLAG 2352 48 load
FLAG 2080 208 0
FLAG 2000 208 0
FLAG 2080 656 0
FLAG 2000 656 0
FLAG 2432 288 0
FLAG 1488 1440 VCC_REF
FLAG 1280 1392 BAT
FLAG 1280 1488 SPV
FLAG 1488 1600 0
FLAG 928 656 BAT
FLAG 1760 1216 0
FLAG 1008 1200 0
FLAG 1072 976 0
FLAG 1792 272 BOOST_5V0
SYMBOL voltage 144 192 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value PWL(0 0 15u 12 4000u 12 4150u 0)
SYMBOL diode 224 176 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D1
SYMATTR Value SP_D
SYMBOL diode 288 80 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D2
SYMATTR Value SP_D
SYMBOL res 368 144 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R1
SYMATTR Value 10m
SYMBOL bv 656 176 R0
SYMATTR InstName BUCK
SYMATTR Value V=if(V(SPV)>3.6,5,0)
SYMBOL bv 656 480 R0
WINDOW 3 -324 64 Left 2
SYMATTR Value V=if(V(BUCK_5V0)>4,4.2,0)
SYMATTR InstName BAT_CH
SYMBOL diode 720 448 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D3
SYMATTR Value BAT_D
SYMBOL diode 784 368 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D4
SYMATTR Value BAT_D
SYMBOL cap 976 480 R0
SYMATTR InstName C1
SYMATTR Value 200µ
SYMBOL res 848 448 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R2
SYMATTR Value 10m
SYMBOL cap 1008 128 R0
SYMATTR InstName C2
SYMATTR Value 10µ
SYMBOL res 864 112 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R3
SYMATTR Value 10m
SYMBOL diode 736 112 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D5
SYMATTR Value BUCK_D
SYMBOL diode 800 0 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D6
SYMATTR Value BUCK_D
SYMBOL bv 1216 496 R0
SYMATTR InstName BOOST
SYMATTR Value V=if(V(BOOST_EN)<0.5,0, if(V(BAT)>2,5,0))
SYMBOL cap 1568 448 R0
SYMATTR InstName C3
SYMATTR Value 10µ
SYMBOL res 1424 432 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R4
SYMATTR Value 10m
SYMBOL diode 1360 320 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D8
SYMATTR Value BOOST_D
SYMBOL diode 1296 432 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D7
SYMATTR Value BOOST_D
SYMBOL Misc\\battery 1136 464 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 1
SYMBOL res 1200 976 M0
SYMATTR InstName R5
SYMATTR Value 51k
SYMBOL res 1200 1120 M0
SYMATTR InstName R6
SYMATTR Value 51k
SYMBOL res 1632 1104 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R7
SYMATTR Value 100
SYMBOL npn 1808 1040 R0
SYMATTR InstName Q1
SYMATTR Value BC847C
SYMBOL res 1856 880 R0
SYMATTR InstName R9
SYMATTR Value 10k
SYMBOL npn 2112 1040 R0
SYMATTR InstName Q2
SYMATTR Value BC847C
SYMBOL res 2160 880 R0
SYMATTR InstName R10
SYMATTR Value 10k
SYMBOL res 2016 992 R0
SYMATTR InstName R11
SYMATTR Value 100k
SYMBOL pmos 1888 -112 R270
SYMATTR InstName M1
SYMATTR Value Si4433DY
SYMBOL res 2512 208 R0
SYMATTR InstName RLOAD
SYMATTR Value 50
SYMBOL pmos 1888 320 R270
SYMATTR InstName M2
SYMATTR Value Si4433DY
SYMBOL pmos 2224 320 M270
SYMATTR InstName M3
SYMATTR Value Si4433DY
SYMBOL pmos 2224 -112 M270
SYMATTR InstName M4
SYMATTR Value Si4433DY
SYMBOL res 2000 272 R0
SYMATTR InstName R12
SYMATTR Value 10k
SYMBOL res 2000 -160 R0
SYMATTR InstName R13
SYMATTR Value 10k
SYMBOL nmos 2032 0 R0
SYMATTR InstName M5
SYMATTR Value BSP89
SYMBOL res 1984 80 R0
SYMATTR InstName R14
SYMATTR Value 100k
SYMBOL nmos 2032 448 R0
SYMATTR InstName M6
SYMATTR Value BSP89
SYMBOL res 1984 528 R0
SYMATTR InstName R15
SYMATTR Value 100k
SYMBOL cap 2416 160 R0
SYMATTR InstName C5
SYMATTR Value 10µ
SYMBOL schottky 1328 1408 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D9
SYMATTR Value MBRB2545CT
SYMBOL schottky 1328 1504 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D10
SYMATTR Value MBRB2545CT
SYMBOL cap 1472 1488 R0
SYMATTR InstName C6
SYMATTR Value 100n
SYMBOL res 800 816 R0
SYMATTR InstName R16
SYMATTR Value 18k
SYMBOL res 800 992 R0
SYMATTR InstName R17
SYMATTR Value 100k
SYMBOL res 928 688 R0
SYMATTR InstName R18
SYMATTR Value 47k
SYMBOL res 1744 1120 R0
SYMATTR InstName R8
SYMATTR Value 47k
SYMBOL Opamps\\LTC6254 1440 1088 M180
SYMATTR InstName U2
SYMBOL cap 1056 864 R0
SYMATTR InstName C4
SYMATTR Value 100n
SYMBOL AutoGenerated\\TL431 944 960 M180
SYMATTR InstName U3
SYMBOL LED 2208 -32 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 72 32 VTop 2
SYMATTR InstName D11
SYMATTR Value NSCW100
SYMBOL res 2320 -32 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R19
SYMATTR Value 1k
SYMBOL res 2320 416 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R20
SYMATTR Value 1k
SYMBOL LED 2192 416 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 72 32 VTop 2
SYMATTR InstName D12
SYMATTR Value NSCW100
TEXT -32 56 Left 2 ;Max current is 160mA
TEXT -8 -112 Left 2 !.model SP_D D(ron=0, ilimit=160m)\n.model BUCK_D D(ron=0, ilimit=3)\n.model BAT_D D(ron=0, ilimit=150m)\n.model BOOST_D D(ron=0, ilimit=4)
TEXT -32 360 Left 2 !.tran 0 10m 10u startup uic
TEXT 2192 808 Left 2 ;connect to EN of boost
TEXT 1624 976 Left 2 ;connect to charger
TEXT 1560 -408 Left 2 !.model iDiode D(ron=0)
