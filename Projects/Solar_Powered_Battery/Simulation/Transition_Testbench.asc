Version 4
SHEET 1 2632 1092
WIRE 1888 -160 1808 -160
WIRE 2016 -160 1984 -160
WIRE 2080 -160 2016 -160
WIRE 2128 -160 2080 -160
WIRE 2304 -160 2224 -160
WIRE 2016 -144 2016 -160
WIRE 2080 -144 2080 -160
WIRE 1968 -48 1968 -112
WIRE 2016 -48 2016 -64
WIRE 2016 -48 1968 -48
WIRE 2080 -48 2080 -80
WIRE 2080 -48 2016 -48
WIRE 2144 -48 2144 -112
WIRE 2144 -48 2080 -48
WIRE 2080 0 2080 -48
WIRE 736 16 656 16
WIRE 848 16 800 16
WIRE 2304 48 2304 -160
WIRE 2352 48 2304 48
WIRE 2432 48 2352 48
WIRE 2528 48 2432 48
WIRE 2000 80 1920 80
WIRE 2032 80 2000 80
WIRE 224 96 144 96
WIRE 352 96 288 96
WIRE 656 96 656 16
WIRE 736 96 656 96
WIRE 848 96 848 16
WIRE 848 96 800 96
WIRE 880 96 848 96
WIRE 992 96 960 96
WIRE 1024 96 992 96
WIRE 1056 96 1024 96
WIRE 2000 96 2000 80
WIRE 352 128 352 96
WIRE 384 128 352 128
WIRE 528 128 464 128
WIRE 592 128 528 128
WIRE 1024 128 1024 96
WIRE 144 160 144 96
WIRE 224 160 144 160
WIRE 352 160 352 128
WIRE 352 160 288 160
WIRE 2432 160 2432 48
WIRE 656 192 656 96
WIRE 144 208 144 160
WIRE 2000 208 2000 176
WIRE 2080 208 2080 96
WIRE 1024 224 1024 192
WIRE 2528 224 2528 48
WIRE 1888 272 1856 272
WIRE 2016 272 1984 272
WIRE 2080 272 2016 272
WIRE 2128 272 2080 272
WIRE 2304 272 2304 48
WIRE 2304 272 2224 272
WIRE 2016 288 2016 272
WIRE 2080 288 2080 272
WIRE 2432 288 2432 224
WIRE 656 304 656 272
WIRE 144 336 144 288
WIRE 1296 336 1216 336
WIRE 1408 336 1360 336
WIRE 720 384 656 384
WIRE 848 384 784 384
WIRE 1968 384 1968 320
WIRE 2016 384 2016 368
WIRE 2016 384 1968 384
WIRE 2080 384 2080 352
WIRE 2080 384 2016 384
WIRE 2144 384 2144 320
WIRE 2144 384 2080 384
WIRE 2528 384 2528 304
WIRE 2080 400 2080 384
WIRE 1216 416 1216 336
WIRE 1296 416 1216 416
WIRE 1408 416 1408 336
WIRE 1408 416 1360 416
WIRE 1440 416 1408 416
WIRE 1552 416 1520 416
WIRE 1584 416 1552 416
WIRE 1616 416 1584 416
WIRE 656 432 656 384
WIRE 720 432 656 432
WIRE 848 432 848 384
WIRE 848 432 784 432
WIRE 864 432 848 432
WIRE 992 432 944 432
WIRE 1024 432 992 432
WIRE 1584 448 1584 416
WIRE 992 480 992 432
WIRE 2000 480 1952 480
WIRE 2032 480 2000 480
WIRE 656 496 656 432
WIRE 2000 496 2000 480
WIRE 1216 512 1216 416
WIRE 1584 544 1584 512
WIRE 656 608 656 576
WIRE 992 608 992 544
WIRE 2000 608 2000 576
WIRE 2080 608 2080 496
WIRE 1216 624 1216 592
WIRE 1872 672 1872 624
WIRE 2176 672 2176 640
WIRE 1136 688 1136 640
WIRE 1472 704 1440 704
WIRE 1872 704 1872 672
WIRE 2176 704 2176 672
WIRE 1328 720 1328 704
WIRE 1136 736 1136 688
WIRE 1472 736 1472 704
WIRE 1328 752 1328 720
WIRE 1264 768 1264 720
WIRE 1264 800 1264 768
WIRE 1872 816 1872 784
WIRE 2032 816 1872 816
WIRE 2176 816 2176 784
WIRE 1872 848 1872 816
WIRE 2176 848 2176 816
WIRE 1440 864 1440 704
WIRE 1136 880 1136 816
WIRE 1328 880 1328 832
WIRE 1360 880 1328 880
WIRE 1408 880 1360 880
WIRE 1648 896 1472 896
WIRE 1696 896 1648 896
WIRE 1808 896 1776 896
WIRE 2112 896 2032 896
WIRE 1264 912 1264 880
WIRE 1360 912 1264 912
WIRE 1408 912 1360 912
WIRE 1648 928 1648 896
WIRE 1264 944 1264 912
WIRE 1440 960 1440 928
WIRE 1648 1024 1648 992
WIRE 1872 1024 1872 944
WIRE 2176 1024 2176 944
WIRE 1440 1040 1440 960
WIRE 1264 1056 1264 1024
FLAG 144 336 0
FLAG 528 128 SPV
FLAG 656 304 0
FLAG 992 96 BUCK_5V0
FLAG 656 608 0
FLAG 992 432 BAT
FLAG 992 608 0
FLAG 1024 224 0
FLAG 1216 624 0
FLAG 1552 416 BOOST_5V0
FLAG 1584 544 0
FLAG 1136 880 0
FLAG 1136 688 BOOST_EN
FLAG 1264 1056 0
FLAG 1264 768 SPV
FLAG 1360 880 op_V+
FLAG 1360 912 op_V-
FLAG 1648 896 op_out
FLAG 1328 720 BAT
FLAG 1872 1024 0
FLAG 1872 672 BAT
FLAG 1872 816 off_sw
FLAG 1648 1024 0
FLAG 1440 960 BAT
FLAG 1472 736 0
FLAG 2176 1024 0
FLAG 2176 672 BAT
FLAG 2176 816 on_sw
FLAG 1920 80 off_sw
FLAG 1808 -160 BUCK_5V0
FLAG 1952 480 on_sw
FLAG 1856 272 BOOST_5V0
FLAG 2528 384 0
FLAG 2352 48 load
FLAG 2080 208 0
FLAG 2000 208 0
FLAG 2080 608 0
FLAG 2000 608 0
FLAG 2432 288 0
SYMBOL voltage 144 192 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value PWL(0 0 15u 12 400u 12 415u 0)
SYMBOL diode 224 176 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D1
SYMATTR Value SP_D
SYMBOL diode 288 80 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D2
SYMATTR Value SP_D
SYMBOL res 368 144 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R1
SYMATTR Value 10m
SYMBOL bv 656 176 R0
SYMATTR InstName BUCK
SYMATTR Value V=if(V(SPV)>3.6,5,0)
SYMBOL bv 656 480 R0
WINDOW 3 -324 64 Left 2
SYMATTR Value V=if(V(off_sw)<0.5,0,if(V(BUCK_5V0)>4,4.2,0))
SYMATTR InstName BAT_CH
SYMBOL diode 720 448 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D3
SYMATTR Value BAT_D
SYMBOL diode 784 368 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D4
SYMATTR Value BAT_D
SYMBOL cap 976 480 R0
SYMATTR InstName C1
SYMATTR Value 1m
SYMBOL res 848 448 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R2
SYMATTR Value 10m
SYMBOL cap 1008 128 R0
SYMATTR InstName C2
SYMATTR Value 10µ
SYMBOL res 864 112 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R3
SYMATTR Value 10m
SYMBOL diode 736 112 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D5
SYMATTR Value BUCK_D
SYMBOL diode 800 0 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D6
SYMATTR Value BUCK_D
SYMBOL bv 1216 496 R0
SYMATTR InstName BOOST
SYMATTR Value V=if(V(BOOST_EN)<0.5,0, if(V(BAT)>2,5,0))
SYMBOL cap 1568 448 R0
SYMATTR InstName C3
SYMATTR Value 10µ
SYMBOL res 1424 432 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R4
SYMATTR Value 10m
SYMBOL diode 1360 320 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D8
SYMATTR Value BOOST_D
SYMBOL diode 1296 432 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D7
SYMATTR Value BOOST_D
SYMBOL Misc\\battery 1136 720 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 1
SYMBOL res 1280 784 M0
SYMATTR InstName R5
SYMATTR Value 47k
SYMBOL res 1280 928 M0
SYMATTR InstName R6
SYMATTR Value 47k
SYMBOL res 1312 736 R0
SYMATTR InstName R8
SYMATTR Value 47k
SYMBOL res 1680 912 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R7
SYMATTR Value 100
SYMBOL npn 1808 848 R0
SYMATTR InstName Q1
SYMATTR Value BC847C
SYMBOL res 1856 688 R0
SYMATTR InstName R9
SYMATTR Value 10k
SYMBOL cap 1632 928 R0
SYMATTR InstName C4
SYMATTR Value 1n
SYMBOL Opamps\\LTC6240 1440 896 M180
SYMATTR InstName U2
SYMBOL npn 2112 848 R0
SYMATTR InstName Q2
SYMATTR Value BC847C
SYMBOL res 2160 688 R0
SYMATTR InstName R10
SYMATTR Value 10k
SYMBOL res 2016 800 R0
SYMATTR InstName R11
SYMATTR Value 100k
SYMBOL pmos 1888 -112 R270
SYMATTR InstName M1
SYMATTR Value Si4433DY
SYMBOL res 2512 208 R0
SYMATTR InstName RLOAD
SYMATTR Value 50
SYMBOL pmos 1888 320 R270
SYMATTR InstName M2
SYMATTR Value Si4433DY
SYMBOL pmos 2224 320 M270
SYMATTR InstName M3
SYMATTR Value Si4433DY
SYMBOL pmos 2224 -112 M270
SYMATTR InstName M4
SYMATTR Value Si4433DY
SYMBOL res 2000 272 R0
SYMATTR InstName R12
SYMATTR Value 10k
SYMBOL res 2000 -160 R0
SYMATTR InstName R13
SYMATTR Value 10k
SYMBOL nmos 2032 0 R0
SYMATTR InstName M5
SYMATTR Value BSP89
SYMBOL res 1984 80 R0
SYMATTR InstName R14
SYMATTR Value 100k
SYMBOL nmos 2032 400 R0
SYMATTR InstName M6
SYMATTR Value BSP89
SYMBOL res 1984 480 R0
SYMATTR InstName R15
SYMATTR Value 100k
SYMBOL cap 2416 160 R0
SYMATTR InstName C5
SYMATTR Value 10µ
TEXT -32 56 Left 2 ;Max current is 160mA
TEXT -8 -112 Left 2 !.model SP_D D(ron=0, ilimit=160m)\n.model BUCK_D D(ron=0, ilimit=3)\n.model BAT_D D(ron=0, ilimit=150m)\n.model BOOST_D D(ron=0, ilimit=4)
TEXT -32 360 Left 2 !.tran 700u startup
TEXT 944 368 Left 2 !.ic V(bat)=4.2
TEXT 2192 808 Left 2 ;connect to EN of boost
TEXT 1624 784 Left 2 ;connect to charger
