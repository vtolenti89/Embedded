Version 4
SHEET 1 1236 1568
WIRE 704 48 656 48
WIRE 832 48 768 48
WIRE -160 128 -336 128
WIRE -48 128 -160 128
WIRE 176 128 48 128
WIRE 240 128 176 128
WIRE 464 128 320 128
WIRE 576 128 464 128
WIRE 656 128 656 48
WIRE 656 128 576 128
WIRE 704 128 656 128
WIRE 832 128 832 48
WIRE 832 128 768 128
WIRE 944 128 832 128
WIRE -160 176 -160 128
WIRE 576 176 576 128
WIRE 176 208 176 128
WIRE 464 224 464 128
WIRE -160 272 -160 240
WIRE 576 272 576 240
WIRE -144 304 -336 304
WIRE 176 320 176 272
WIRE 464 352 464 304
WIRE 464 400 464 352
WIRE 176 512 176 448
WIRE 304 512 304 448
WIRE 464 528 464 480
WIRE 32 544 32 176
WIRE 176 544 176 512
WIRE 304 544 304 512
WIRE 32 688 32 624
WIRE 176 688 176 624
WIRE 304 688 304 624
FLAG 464 528 0
FLAG 464 352 fb
FLAG 944 128 out
IOPIN 944 128 Out
FLAG -336 128 in
IOPIN -336 128 In
FLAG 576 272 0
FLAG 176 320 0
FLAG 304 512 comp
FLAG 176 512 ramp
FLAG 32 688 0
FLAG 176 688 0
FLAG 304 688 0
FLAG -336 304 EN
IOPIN -336 304 In
FLAG -160 272 0
SYMBOL res 448 208 R0
SYMATTR InstName R2
SYMATTR Value 10k
SYMBOL res 448 384 R0
SYMATTR InstName R3
SYMATTR Value 10k
SYMBOL cap 560 176 R0
SYMATTR InstName C1
SYMATTR Value 10µ
SYMBOL ind 336 112 R90
WINDOW 0 5 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName L1
SYMATTR Value 4.7µ
SYMATTR SpiceLine Rser=30m
SYMBOL schottky 192 272 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMATTR Value 1N5817
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL bv 304 528 R0
WINDOW 3 -45 32 VRight 2
SYMATTR Value V=((V(fb)-2.1) * gain+Vst/2)
SYMATTR InstName B2
SYMBOL voltage 176 528 M0
WINDOW 3 63 438 VLeft 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value PULSE(0 {Vst} 0 {Tp} 1p 0 {Tp})
SYMATTR InstName V1
SYMBOL bv 32 528 R0
WINDOW 3 -53 20 VRight 2
SYMATTR Value V=(if( V(in)<Vuv, 0, if(V(en)<Ven,0,if(V(ramp)>V(comp),50, 0))))
SYMATTR InstName B3
SYMBOL nmos -48 176 R270
SYMATTR InstName M2
SYMATTR Value Si7336ADP
SYMBOL diode 704 144 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D2
SYMATTR Value MYDCH
SYMBOL diode 768 32 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D3
SYMATTR Value MYDCH
SYMBOL cap -176 176 R0
SYMATTR InstName C2
SYMATTR Value 10µ
TEXT 704 504 Left 2 !.param freq=100e3\n.param tp=1/freq\n.param Vst 4.2\n.param gain 1000\n.param Vuv 4\n.param Ven 1.2
TEXT 800 232 Left 2 !.model mydch d(ron=0, ilimit=130m)
